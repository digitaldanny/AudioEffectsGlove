Version 4
SHEET 1 4020 1620
WIRE -272 -32 -272 -64
WIRE -80 -32 -272 -32
WIRE 320 -32 -80 -32
WIRE 1264 -16 1168 -16
WIRE 1568 -16 1264 -16
WIRE 2064 -16 1568 -16
WIRE 2368 -16 2064 -16
WIRE -80 64 -80 -32
WIRE 320 64 320 -32
WIRE 128 112 -16 112
WIRE 256 112 128 112
WIRE 1568 144 1568 -16
WIRE 1536 160 1424 160
WIRE 2368 160 2368 -16
WIRE 1824 176 1600 176
WIRE 2336 176 1824 176
WIRE -80 192 -80 160
WIRE 128 192 128 112
WIRE 128 192 -80 192
WIRE 1536 192 1424 192
WIRE 2608 192 2400 192
WIRE 320 208 320 160
WIRE 752 208 320 208
WIRE 784 208 752 208
WIRE 2336 208 2240 208
WIRE -1200 224 -1200 112
WIRE -80 224 -80 192
WIRE -928 240 -928 176
WIRE -736 240 -736 176
WIRE -528 240 -528 128
WIRE 1568 272 1568 208
WIRE 2368 272 2368 224
WIRE 752 288 752 208
WIRE 2064 336 2064 -16
WIRE 2112 336 2064 336
WIRE 2240 336 2240 208
WIRE 2240 336 2192 336
WIRE -1200 352 -1200 304
WIRE -928 352 -928 320
WIRE -736 352 -736 320
WIRE -736 352 -928 352
WIRE -528 352 -528 320
WIRE -528 352 -736 352
WIRE -80 352 -80 304
WIRE 2240 368 2240 336
WIRE -528 384 -528 352
WIRE 1264 448 1264 -16
WIRE 1280 448 1264 448
WIRE 1424 448 1424 192
WIRE 1424 448 1360 448
WIRE 1504 448 1424 448
WIRE 1824 448 1824 176
WIRE 1824 448 1584 448
WIRE 752 464 752 368
WIRE 2240 480 2240 448
WIRE 1424 496 1424 448
WIRE 752 560 752 528
WIRE 912 560 752 560
WIRE 1008 560 912 560
WIRE 752 592 752 560
WIRE 2208 848 2128 848
WIRE 2368 848 2288 848
WIRE 1440 880 1440 848
WIRE -272 1008 -272 -32
WIRE -64 1008 -272 1008
WIRE 240 1008 192 1008
WIRE 320 1008 240 1008
WIRE 544 1008 416 1008
WIRE 752 1008 752 656
WIRE 752 1008 640 1008
WIRE 800 1008 752 1008
WIRE 1440 1008 1440 960
WIRE 1680 1008 1440 1008
WIRE 2128 1008 2128 848
WIRE 2128 1008 1936 1008
WIRE 1440 1040 1440 1008
WIRE 2256 1056 2256 1008
WIRE 2128 1072 2128 1008
WIRE 2224 1072 2128 1072
WIRE 2688 1072 2688 1040
WIRE 2368 1088 2368 848
WIRE 2368 1088 2288 1088
WIRE 2656 1088 2368 1088
WIRE 2224 1104 2128 1104
WIRE 2896 1104 2720 1104
WIRE 2656 1120 2592 1120
WIRE 2688 1152 2688 1136
WIRE 1440 1168 1440 1120
WIRE 1680 1168 1856 1008
WIRE 1680 1168 1440 1168
WIRE 1856 1168 1680 1008
WIRE 2128 1168 2128 1104
WIRE 2128 1168 1936 1168
WIRE 240 1184 240 1008
WIRE 368 1184 368 1072
WIRE 592 1184 592 1072
WIRE 2256 1184 2256 1120
WIRE 2448 1184 2416 1184
WIRE 2592 1184 2592 1120
WIRE 2592 1184 2528 1184
WIRE 2592 1216 2592 1184
WIRE 64 1296 64 1104
WIRE 240 1296 240 1264
WIRE 240 1296 64 1296
WIRE 368 1312 368 1264
WIRE 592 1312 592 1264
WIRE 2128 1312 2128 1168
WIRE 240 1328 240 1296
WIRE 2592 1344 2592 1296
WIRE 1440 1360 1440 1168
WIRE 2128 1424 2128 1392
WIRE 240 1440 240 1408
FLAG -1200 352 0
FLAG -528 384 0
FLAG 1568 272 0
FLAG 1424 576 0
FLAG -528 128 DAD_5V
FLAG -272 -64 DAD_5V
FLAG -80 352 V_schmitt
FLAG 1424 160 V_battery
FLAG -1200 112 V_battery
FLAG 1168 -16 DAD_5V
FLAG 2608 192 V_schmitt
FLAG 2368 272 0
FLAG 2240 480 0
FLAG 368 1312 V_schmitt
FLAG -736 176 VRef_4_2
FLAG -928 176 VRef_3_7
FLAG 784 208 Vcc
FLAG 800 1008 Vcv
FLAG 2128 1424 0
FLAG 2416 1184 DAD_5V
FLAG 2592 1344 0
FLAG 2688 1152 0
FLAG 2688 1040 DAD_5V
FLAG 2896 1104 V_termination
FLAG 240 1440 0
FLAG 1440 848 Vref_4_2
FLAG 1008 560 V_charger
FLAG 592 1312 V_termination
FLAG 1440 1360 0
FLAG 912 640 0
FLAG 2256 1184 0
FLAG 2256 1008 DAD_5V
SYMBOL voltage -528 224 R0
SYMATTR InstName DAD+5
SYMATTR Value 5
SYMBOL res 1600 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Ra
SYMATTR Value 1.8k
SYMBOL res 1408 480 R0
SYMATTR InstName Rb
SYMATTR Value 1.15k
SYMBOL res 1376 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Roff
SYMATTR Value 250
SYMBOL voltage -1200 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Battery
SYMATTR Value SINE(2.1 2.1 100)
SYMBOL res -96 208 R0
SYMATTR InstName R4
SYMATTR Value 4k
SYMBOL pnp -16 160 R180
SYMATTR InstName Q3
SYMBOL pnp 256 160 M180
SYMATTR InstName Q4
SYMBOL res 2208 320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 850
SYMBOL res 2224 464 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL OpAmps\\UniversalOpamp2 1568 176 R0
SYMATTR InstName U1
SYMBOL OpAmps\\UniversalOpamp2 2368 192 R0
SYMATTR InstName U2
SYMBOL voltage -736 224 R0
SYMATTR InstName V1
SYMATTR Value 4.2
SYMBOL voltage -928 224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 3.7
SYMBOL res 1424 1024 R0
SYMATTR InstName R8
SYMATTR Value .1
SYMBOL res 2304 832 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL res 2144 1408 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL res 1840 1184 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL res 1840 1024 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL OpAmps\\UniversalOpamp2 2688 1104 R0
SYMATTR InstName U4
SYMBOL res 2544 1168 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 4.5k
SYMBOL res 2576 1200 R0
SYMATTR InstName R14
SYMATTR Value 100
SYMBOL PowerProducts\\LT1117 64 1008 R0
SYMATTR InstName U5
SYMBOL res 224 1168 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL res 224 1312 R0
SYMATTR InstName R2
SYMATTR Value 2360
SYMBOL npn 320 1072 R270
SYMATTR InstName Q1
SYMBOL res 352 1168 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL res 736 272 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL diode 736 464 R0
SYMATTR InstName D1
SYMBOL diode 768 656 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL res 576 1168 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL res 1424 864 R0
SYMATTR InstName R_batteryLoadTest
SYMATTR Value 400
SYMBOL res 896 544 R0
SYMATTR InstName R_testLoad
SYMATTR Value 1000
SYMBOL OpAmps\\UniversalOpamp2 2256 1088 R0
SYMATTR InstName U3
SYMBOL pnp 640 1072 M270
SYMATTR InstName Q2
TEXT -512 -144 Left 2 !.tran 25m
TEXT -56 -80 Left 2 ;Constant Current Source (CC)
TEXT 0 608 Left 2 ;Constant Voltage Supply (CV)
TEXT 1216 -64 Left 2 ;3.7 - 4.2V Threshold Detector (CC/CV Switching)
TEXT 2176 224 Left 2 ;2.7V
TEXT 2072 -56 Left 2 ;Direct compare using open loop gain (A) to swing output quicker (Also inverts)
TEXT -16 272 Left 2 ;Schmitt = LOW, CC current = ON
TEXT 384 1136 Left 2 ;Schmitt = HIGH, CV current = ON
TEXT 1432 360 Left 2 ;3.7 - 4.2 V Triggers
TEXT 1448 1136 Left 2 ;high power shunt resistor (I_battery)
TEXT 2616 1184 Left 2 ;High when I_shunt <= 0.1C
TEXT 1624 752 Left 2 ;Termination current sensing circuit
TEXT 760 976 Left 2 ;Vcv = 4.2V + 0.7V (accounts for diode drop)
TEXT 824 328 Left 2 ;Icc = 0.1C (1.1mA in this circuit)
TEXT 608 1296 Left 2 ;Termination = LOW, CV current = ON
TEXT 1624 784 Left 2 ;Low-side shunt removes common mode rejection ration (CMRR) with low tolerance resistors
