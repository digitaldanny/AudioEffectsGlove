* C:\Users\Daniel\Desktop\SW_Projects\GestureControl\ltspice\CCCV Battery Charger.asc
V§DAD+5 DAD_5V 0 5
Ra N002 N003 3.9k
Rb N003 0 1k
Roff N003 DAD_5V 220
V§Battery V_battery 0 EXP(3.0 4.2 2m 5m 25m 0.005)
R4 N001 V_schmitt 4k
Q3 N001 N001 DAD_5V 0 PNP
Q4 N004 N001 DAD_5V 0 PNP
R5 N005 DAD_5V 850
R7 0 N005 1k
XU1 N003 V_battery DAD_5V 0 N002 level.2 Avol=1Meg GBW=10Meg Slew=10Meg ilimit=25m rail=0 Vos=0 phimargin=45 en=0 enk=0 in=0 ink=0 Rin=500Meg
XU2 N005 N002 DAD_5V 0 V_schmitt level.2 Avol=1Meg GBW=10Meg Slew=10Meg ilimit=25m rail=0 Vos=0 phimargin=45 en=0 enk=0 in=0 ink=0 Rin=500Meg
V1 VRef_4_15 0 4.15
V2 VRef_3_9 0 3.9
R8 N009 0 .1
R9 N007 N006 100k
R10 0 N010 100k
R11 N009 N010 1k
R12 0 N006 1k
XU4 N015 N007 DAD_5V 0 N011 level.2 Avol=1Meg GBW=10Meg Slew=10Meg ilimit=25m rail=0 Vos=0 phimargin=45 en=0 enk=0 in=0 ink=0 Rin=500Meg
R13 N015 DAD_5V 4.7k
R14 N015 0 100
XU5 N018 N012 DAD_5V LT1117
R1 N012 N018 1k
R2 N018 0 2.2k
Q1 N012 N016 N013 0 NPN
R15 N016 V_schmitt 1k
R6 N017 V_termination 1k
XU3 N010 N006 DAD_5V 0 N007 level.2 Avol=1Meg GBW=10Meg Slew=10Meg ilimit=25m rail=0 Vos=0 phimargin=45 en=0 enk=0 in=0 ink=0 Rin=500Meg
Q2 N013 N017 N014 0 NPN
V3 N009 0 1m
XU6 N011 V_termination DAD_5V 0 V_termination level.2 Avol=1Meg GBW=10Meg Slew=10Meg ilimit=25m rail=0 Vos=0 phimargin=45 en=0 enk=0 in=0 ink=0 Rin=500Meg
R3 0 N014 4.7k
D1 N004 V_battery D
D2 N008 V_battery D
R16 N008 N014 100
.model D D
.lib C:\Users\Daniel\Documents\LTspiceXVII\lib\cmp\standard.dio
.model NPN NPN
.model PNP PNP
.lib C:\Users\Daniel\Documents\LTspiceXVII\lib\cmp\standard.bjt
.tran 40m
* Constant Current Source (CC)
* Constant Voltage Supply (CV)
* 3.7 - 4.2V Threshold Detector (CC/CV Switching)
* 2.7V
* Direct compare using open loop gain (A) to swing output quicker and invert the signal (using Rail-to-Rail op-amp)
* Schmitt = LOW, CC current = ON
* Schmitt = HIGH, CV current = ON
* 3.7 - 4.2 V Triggers
* high power shunt resistor (I_battery)
* High when I_shunt <= 0.1C (~1.1 mA)
* Termination current sensing circuit
* Vcv = 4.2V
* Icc = 0.1C (1.1mA in this circuit)
* Termination = LOW, CV current = ON
* Low-side shunt removes common mode rejection ration (CMRR) with low tolerance resistors
.lib LT1117.lib
.lib UniversalOpamps2.sub
.backanno
.end
